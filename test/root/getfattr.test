	$ mkdir d
	$ cd d

	$ touch f
	$ setfattr -n user.test -v test f
	$ ln -s f l
	$ setfattr -h -n trusted.test -v test l

This case should be obvious:
	$ getfattr -m- -d f
	> # file: f
	> user.test="test"
	>

Without -h, we dereference symlinks:
	$ getfattr -m- -d l
	> # file: l
	> user.test="test"
	>

With -h, we do not dereference symlinks:
	$ getfattr -m- -hd l
	> # file: l
	> trusted.test="test"
	>

Do the same for symlinks we find in a directory hierarchy:
	$ getfattr -m- -Rd . | grep file: | sort
	> # file: f
	> # file: l

	$ getfattr -m- -Rhd . | grep file: | sort
	> # file: f
	> # file: l

Make sure we follow symlinks on the command line only when we should:
	$ ln -s . here
	$ getfattr -m- -Rd here | grep file: | sort
	> # file: here/f
	> # file: here/l

	$ getfattr -m- -Rhd here | grep file: | sort
	> # file: here/f
	> # file: here/l

	$ getfattr -m- -RLhd here | grep file: | sort
	> # file: here/f
	> # file: here/l

	$ getfattr -m- -RPhd here

Make sure we recurse into sub-directories:
	$ mkdir sub
	$ mv f l sub
	$ getfattr -m- -Rd . | grep file: | sort
	> # file: sub/f
	> # file: sub/l

	$ getfattr -m- -Rhd . | grep file: | sort
	> # file: sub/f
	> # file: sub/l

Make sure we follow symlinks to directories only when we should:
	$ mkdir sub2
	$ ln -s ../sub sub2/to-sub
	$ getfattr -m- -Rhd sub2

	$ getfattr -m- -RLhd sub2 | grep file: | sort
	> # file: sub2/to-sub/f
	> # file: sub2/to-sub/l

	$ getfattr -m- -RPhd sub2

Symlink loop detection:
	$ ln -s .. sub/up
	$ getfattr -m- -RLhd . | grep file: | sort
	> # file: sub2/to-sub/f
	> # file: sub2/to-sub/l
	> # file: sub/f
	> # file: sub/l

	$ cd ..
	$ rm -rf d
